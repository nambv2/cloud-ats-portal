define(["keyword/module","lodash"],function(a,b){"use strict";a.registerController("OverviewCtrl",["$scope","$rootScope","$state","$stateParams","$templateRequest","$compile","$cookies","KeywordService","EventService",function(a,c,d,e,f,g,h,i,j){a.projectId=e.id,a.title="OVERVIEWS",a.suiteReports=[],a.dataReports=[],a.project=null,i.get(a.projectId,function(b){a.project=b,a.project.lastJobId&&k(a.project._id)});var k=function(c){i.getListReport(c,function(c,d){a.listReports=[],b.forEach(c,function(c){var d={created_date:c.created_date,job_id:c.report.functional_job_id,total_test_case:0,total_pass:0,total_fail:0};b.forEach(c.report.suite_reports,function(a){d.total_test_case+=a.total_test_case,d.total_pass+=a.total_pass,d.total_fail+=a.total_fail}),0==d.total_fail?d.test_result="Pass":d.test_result="Fail",a.listReports.push(d)})})};a.redirectTo=function(b){d.go("app.keyword.report",{id:a.projectId,jobId:b})};var l=function(){var b=$("#project-log");b.html(""),f("app/keyword/views/overview-modal-content.tpl.html").then(function(c){b.html(g(c)(a)),b.modal("show")})};a.viewLog=function(){l()},a.runLastSuites=function(){a.project.status="RUNNING",a.project.log=void 0,a.project.watchUrl=void 0;var c=[];b.forEach(a.project.lastSuites,function(a){c.push(a._id)}),i.run(a.projectId,c,function(a,b){switch(b){case 201:$.smallBox({title:"Notification",content:"You have submitted project job",color:"#296191",iconSmall:"fa fa-check bounce animated",timeout:3e3});break;case 204:$.smallBox({title:"Notification",content:"Your project has been already running",color:"#296191",iconSmall:"fa fa-check bounce animated",timeout:3e3});break;default:$.smallBox({title:"Notification",content:"Can not submmit your project job",color:"#c26565",iconSmall:"fa fa-ban bounce animated",timeout:3e3})}})};var m=function(){var b=$("#project-edittion");b.html(""),f("app/keyword/views/project-edittion-modal-content.tpl.html").then(function(c){b.html(g(c)(a)),b.modal("show")})};a.edit=function(){m(),a.newName=angular.copy(a.project.name)},a.update=function(b){var c=$("#project-edittion");return a.newName?void i.update(a.projectId,b,function(d,e){switch(e){case 304:$.smallBox({title:"Notification",content:"Your project name does not change",color:"#296191",iconSmall:"fa fa-check bounce animated",timeout:3e3});break;case 202:$.smallBox({title:"Notification",content:"Your project has been updated",color:"#296191",iconSmall:"fa fa-check bounce animated",timeout:3e3}),a.project.name=b}c.modal("hide")}):(c.find(".form-group").addClass("has-error"),void c.find(".form-group").children().first().focus())},a["delete"]=function(){$.SmartMessageBox({title:"Delete project",content:"Are you sure to delete the project",buttons:"[No][Yes]"},function(b){"Yes"===b&&i["delete"](a.projectId,function(a,b){200===b&&($.smallBox({title:"Notification",content:"<i class='fa fa-clock-o'></i> <i>The project has already deleted</i>",color:"#296191",iconSmall:"fa fa-check fa-2x fadeInRight animated",timeout:4e3}),d.go("app.projects"))}),"No"===b})};var n=function(c){a.$apply(function(){var d=JSON.parse(c.data);if(d.project_id===a.projectId&&(a.project.status=d.project_status,a.project.watchUrl=d.watch_url,a.project.log=d.log,"READY"===d.project_status)){var e={created_date:void 0,job_id:void 0,total_test_case:0,total_pass:0,total_fail:0};i.getReport(a.projectId,d._id,function(a,c){e.created_date=a.created_date,e.job_id=a.functional_job_id;var d=JSON.parse(a.suite_reports);b.forEach(d,function(a){e.total_test_case+=a.total_test_case,e.total_pass+=a.total_pass,e.total_fail+=a.total_fail}),0===e.total_fail?e.test_result="Pass":e.test_result="Fail"}),a.listReports.unshift(e),$.smallBox({title:"Notification",content:"The job "+d._id+" has completed.",color:"#296191",iconSmall:"fa fa-check bounce animated",timeout:3e3})}})};j.feed(n)}])});