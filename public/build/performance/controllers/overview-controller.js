define(["performance/module","lodash","notification"],function(a,b){"use strict";a.registerController("OverviewPerformanceCtrl",["$scope","$rootScope","$stateParams","$state","$templateRequest","$compile","PerformanceService","EventService",function(a,c,d,e,f,g,h,i){a.projectId=d.id,a.title="OVERVIEWS",h.get(a.projectId,function(b){if(a.project=b,null!=b.jobs){var c=JSON.parse(b.jobs);a.project.jobs=c}}),a.openJobReport=function(a){e.go("app.performance.report",{jobId:a})};var j=function(){var b=$("#project-log");b.html(""),f("app/performance/views/overview-modal-content.tpl.html").then(function(c){b.html(g(c)(a)),b.modal("show")})};a.viewLog=function(){j()};var k=function(){var b=$("#project-edittion");b.html(""),f("app/performance/views/project-edittion-modal-content.tpl.html").then(function(c){b.html(g(c)(a)),b.modal("show")})};a.edit=function(){k(),a.newName=angular.copy(a.project.name)};var l=$("#project-edittion").find("input");$("body").on("keypress",l,function(){var b=$("#project-edittion").find("input");(""!=a.newName||void 0!=a.newName)&&b.parent().removeClass("has-error")}),a.update=function(b){var c=$("#project-edittion");return a.newName?void h.update(a.projectId,b,function(d,e){switch(e){case 304:$.smallBox({title:"Notification",content:"Your project name does not change",color:"#296191",iconSmall:"fa fa-check bounce animated",timeout:3e3});break;case 202:$.smallBox({title:"Notification",content:"Your project has been updated",color:"#296191",iconSmall:"fa fa-check bounce animated",timeout:3e3}),a.project.name=b}c.modal("hide")}):(c.find(".form-group").addClass("has-error"),void c.find(".form-group").children().first().focus())},a["delete"]=function(){$.SmartMessageBox({title:"Delete project",content:"Are you sure to delete the project",buttons:"[No][Yes]"},function(b){"Yes"===b&&h["delete"](a.projectId,function(a,b){200===b&&($.smallBox({title:"Notification",content:"<i class='fa fa-clock-o'></i> <i>The project has already deleted</i>",color:"#296191",iconSmall:"fa fa-check fa-2x fadeInRight animated",timeout:4e3}),e.go("app.projects"))}),"No"===b})},a.runLastScripts=function(){a.project.status="RUNNING",a.project.log=void 0;var c=[];b.forEach(a.project.lastScripts,function(a){c.push(a._id)}),h.run(a.projectId,c,function(b,c){switch(c){case 200:$.smallBox({title:"Notification",content:"You have submitted project job",color:"#296191",iconSmall:"fa fa-check bounce animated",timeout:3e3});break;case 204:$.smallBox({title:"Notification",content:"Your project has been already running",color:"#296191",iconSmall:"fa fa-check bounce animated",timeout:3e3});break;default:$.smallBox({title:"Notification",content:"Can not submmit your project job",color:"#c26565",iconSmall:"fa fa-ban bounce animated",timeout:3e3})}a.project.jobs.unshift(b)})};var m=function(c){a.$apply(function(){var d=JSON.parse(c.data);if(d.project_id===a.projectId){switch(a.project.status=d.project_status,a.project.log=d.log,d.status){case"Running":var e=b.find(a.project.jobs,function(a){return d._id===a._id});e.status="Running";break;case"Completed":var e=b.find(a.project.jobs,function(a){return d._id===a._id});e.status="Completed"}"READY"===a.project.status&&$.smallBox({title:"Notification",content:"The job "+d._id+" has completed.",color:"#296191",iconSmall:"fa fa-check bounce animated",timeout:3e3})}})};i.feed(m)}])});