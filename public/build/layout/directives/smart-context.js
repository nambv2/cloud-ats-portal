define(["layout/module"],function(a){"use strict";a.registerDirective("smartContext",["$rootScope","$state","$cookies","$window","AuthenticationService","UserService",function(a,b,c,d,e,f){return{restrict:"A",compile:function(g,h){g.removeAttr("smart-context data-smart-context");var i=function(g,h,i,j,k){var l=void 0!==h.data&&h.data.requireLogin;if(l){if(void 0===c.get("authToken"))return d.sessionStorage.setItem("context",null),b.go("login"),void g.preventDefault();var m=d.sessionStorage.getItem("context");"null"===m||null===m?e.context().then(function(a){if(void 0===a.user&&void 0===a.tenant)return b.go("login"),void g.preventDefault();var d=c.get("space");void 0!==d&&"null"!==d&&f.go({_id:d})}):a.context=JSON.parse(m)}};a.$on("$stateChangeStart",i)}}}])});