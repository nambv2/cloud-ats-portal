define(["layout/module","lodash"],function(a,b){"use strict";return a.registerDirective("smartWizard",function(){return{restrict:"A",scope:{smartWizardCallback:"&",smartStepCallback:"&"},link:function(a,c,d){function e(d){if(g=d,$("[data-smart-wizard-pane="+d+"]",c).addClass("active").siblings("[data-smart-wizard-pane]").removeClass("active"),$("[data-smart-wizard-tab="+d+"]",c).addClass("active").siblings("[data-smart-wizard-tab]").removeClass("active"),j.toggleClass("disabled",1==d),"function"==typeof a.smartStepCallback()){var e={};b.each(i.serializeArray(),function(a){e[a.name]=a.value}),a.smartStepCallback()(g,e)}}var f=$("[data-smart-wizard-tab]",c).length,g=1,h=[],i=c.closest("form"),j=$("[data-smart-wizard-prev]",c),k=$("[data-smart-wizard-next]",c);c.on("click","[data-smart-wizard-tab]",function(a){var d=parseInt($(this).data("smartWizardTab"));if(i.data("validator")){if(!i.valid())return h=b.without(h,g),i.data("validator").focusInvalid(),!1;h=b.without(h,g),h.push(g),c.find("[data-smart-wizard-tab="+g+"]").addClass("complete").find(".step").html('<i class="fa fa-check"></i>'),e(d),a.preventDefault()}else e(d),a.preventDefault()}),k.on("click",function(d){if(i.data("validator")){if(!i.valid())return h=b.without(h,g),i.data("validator").focusInvalid(),!1;h=b.without(h,g),h.push(g),c.find("[data-smart-wizard-tab="+g+"]").addClass("complete").find(".step").html('<i class="fa fa-check"></i>')}if(f>g)e(g+1);else if(h.length<f){var j=b.range(1,f+1);b(j).forEach(function(a){return-1==h.indexOf(a)?(e(a),!1):void 0})}else{var k={};b.each(i.serializeArray(),function(a){k[a.name]=a.value}),"function"==typeof a.smartWizardCallback()&&a.smartWizardCallback()(k)}d.preventDefault()}),j.on("click",function(a){!j.hasClass("disabled")&&g>0&&e(g-1),a.preventDefault()}),e(g)}}})});