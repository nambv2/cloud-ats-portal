define(["datadriven/module","notification"],function(a){"use strict";a.registerController("ProviderCtrl",["$rootScope","$scope","UserService","DataService",function(a,b,c,d){b.list=!0,b.selected=void 0,b.selectedDataSet=[],a.$watch("context",function(a){var b=a.tenant._id,c=a.space;void 0===c&&(c={_id:null}),e(b,c)});var e=function(a,c){d.list(a,c._id).then(function(a){b.data=a,a.length>0&&(b.selected=a[0])})},f=a.context.tenant._id,g=a.context.space;void 0===g&&(g={_id:null}),e(f,g),b.$watch("selected",function(a){h()}),b.select=function(a){b.selected=a,b.selected.editable=!1},b.toggleList=function(){var a=$("div.list-data-driven"),b=$("div.data-driven-container");a.slideToggle(200),b.toggleClass("col-md-9"),b.toggleClass("col-md-12")};var h=function(){return void 0===b.selected?[]:void(b.selectedDataSet=JSON.parse(b.selected.data_source))};b.deleteDataSet=function(a){$.SmartMessageBox({title:"Data Driven",content:"Are you sure to delete '"+a.name+"'?",buttons:"[No][Yes]"},function(c){"Yes"===c&&d.deleteDataSetById(a._id,function(c){_.remove(b.data,function(b){return b._id==a._id}),b.data.length>0&&(b.selected=b.data[0])})})},b.createDataSet=function(){var a=$('div.data-provider form input[name="provider_name"]').val();if(void 0!==a&&""!==a){var c=[];$("div.data-provider table thead th.filedName").each(function(a,b){var d=$(b).text().trim();c[a]=d});var e=[];$("div.data-provider table tbody tr.fieldValues").each(function(a,b){var c=[];$(b).find("td.cell").each(function(a,b){c[a]=$(b).text().trim()}),e[a]=c});var f=[];_.forEach(e,function(a){var b={};$(c).each(function(c,d){b[d]=a[c]}),f.push(b)}),d.create(a,f,function(a,c){200==c&&(b.data.push(a),b.list=!0,b.selected=a)})}},b.saveUpdateDataSet=function(){var a=[];$("table thead th.filedName").each(function(b,c){var d=$(c).text().trim();a[b]=d});var c=[];$("table tbody tr.fieldValues").each(function(a,b){var d=[];$(b).find("td.cell").each(function(a,b){d[a]=$(b).text().trim()}),c[a]=d});var e=[];_.forEach(c,function(b){var c={};$(a).each(function(a,d){c[d]=b[a]}),e.push(c)});var f=$('div.smart-form input[name="driven-name"]').val();d.update(b.selected._id,f,e,function(a,c){b.selected=a;var d=_.findIndex(b.data,function(b){return b._id==a._id});b.data[d]=a,$.smallBox({title:"Data Driven",content:"<i class='fa fa-clock-o'></i> <i>Your data driven has updated.</i>",color:"#659265",iconSmall:"fa fa-check fa-2x fadeInRight animated",timeout:2e3})})},b.cancelUpdateDataSet=function(){b.selected.editable=!1}}])});