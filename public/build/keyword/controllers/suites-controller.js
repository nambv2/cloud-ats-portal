define(["keyword/module","lodash"],function(a,b){"use strict";a.registerController("SuitesCtrl",["$scope","$stateParams","$templateRequest","$compile","CaseService","SuiteService",function(a,c,d,e,f,g){a.projectId=c.id,a.title="TEST SUITES",a.editMode=!1,g.list(a.projectId,function(b){a.suites=b,f.references(a.projectId,function(b){a.cases=b,a.suites.length>0&&a.selectSuite(a.suites[0])})});var h=function(){var b=$("#testcase-container");d("app/keyword/views/testsuite-editable.tpl.html").then(function(c){b.html(e(c)(a)),b.fadeIn()})},i=function(c){var d=b.find(a.cases,function(a){return a._id==c._id});return d.name};a.checkExistingCase=function(c){var d=b.find(a.current.cases,function(a){return a._id===c._id});return void 0!==d},a.selectSuite=function(c){b.forEach(c.cases,function(a){a.name=i(a)});var d=[];b.forEach(a.cases,function(a){var e=b.find(c.cases,a);void 0===e&&d.push(a)}),c.caseOutline=d,c.originCases=b.cloneDeep(c.cases),c.originCaseOutline=b.cloneDeep(c.caseOutline),a.current=c,h()},a.deleteTestSuite=function(c){g["delete"](a.projectId,c._id,function(d,e){switch(e){case 200:$.smallBox({title:"Notification",content:"Your test suite has deleted",color:"#296191",iconSmall:"fa fa-check bounce animated",timeout:3e3}),b.remove(a.suites,function(a){return a._id===c._id}),a.suites.length>0?a.selectSuite(a.suites[0]):a.current=[];break;default:$.smallBox({title:"Notification",content:"Can not delete your test suite",color:"#c26565",iconSmall:"fa fa-ban bounce animated",timeout:3e3})}})},a.saveEditTestSuite=function(){if(a.current.temp){var b=$("#input-new-testsuite-name");if(void 0===a.current.name||""===a.current.name||null===a.current.name)return b.focus(),b.addClass("state-error"),!1;g.create(a.projectId,a.current,function(b,c){switch(c){case 201:$.smallBox({title:"Notification",content:"Your test suite has created",color:"#296191",iconSmall:"fa fa-check bounce animated",timeout:3e3}),a.suites.push(b),a.selectSuite(b);break;default:$.smallBox({title:"Notification",content:"Can not create your test suite",color:"#c26565",iconSmall:"fa fa-ban bounce animated",timeout:3e3})}})}else g.update(a.projectId,a.current,function(b,c){switch(c){case 200:$.smallBox({title:"Notification",content:"Your test suite has updated",color:"#296191",iconSmall:"fa fa-check bounce animated",timeout:3e3}),a.suites.push(b),a.editMode=!1;break;case 204:$.smallBox({title:"Notification",content:"Your test suite has nothing to date",color:"#296191",iconSmall:"fa fa-check bounce animated",timeout:3e3}),a.suites.push(b),a.editMode=!1;break;default:$.smallBox({title:"Notification",content:"Can not update your test suite",color:"#c26565",iconSmall:"fa fa-ban bounce animated",timeout:3e3})}})},a.cancelEditTestSuite=function(){a.editMode=!1,a.current.temp?(a.current=void 0,a.suites.length>0&&a.selectSuite(a.suites[0])):(a.current.cases=b.cloneDeep(a.current.originCases),a.current.caseOutline=b.cloneDeep(a.current.originCaseOutline))},a.inputNewSuiteNameBlur=function(b){var c=b.currentTarget;(void 0===a.current.name||""===a.current.name||null===a.current.name)&&($(c).focus(),$(c).addClass("state-error"))},a.inputNewSuiteNameKeypress=function(a){var b=a.currentTarget;$(b).removeClass("state-error")},a.clickSelectTestCase=function(c,d){if(a.editMode||a.current.temp){var e=$("#input-new-testsuite-name");if(void 0===a.current.name||""===a.current.name||null===a.current.name)return e.focus(),e.addClass("state-error"),!1;var f=$(c.currentTarget),g=b.indexOf(a.current.cases,d);-1==g?(b.remove(a.current.caseOutline,function(a){return a._id==d._id}),a.current.cases.push(d),f.addClass("test-case-selected")):(b.remove(a.current.cases,function(a){return a._id==d._id}),a.current.caseOutline.push(d),f.removeClass("test-case-selected")),h()}},a.clickNewTestSuiteButton=function(){void 0!==a.current&&a.current.temp||a.editMode||(a.current={name:void 0,cases:[],caseOutline:b.cloneDeep(a.cases),temp:!0},a.editMode=!1,h())}}])});