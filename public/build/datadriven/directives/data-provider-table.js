define(["datadriven/module","lodash"],function(a,b){"use strict";return a.registerDirective("providerTable",[function(){return{restrict:"E",replace:!0,templateUrl:"build/datadriven/directives/data-provider-table.tpl.html",scope:{dataset:"=",editable:"="},link:function(a,c){a.editableOptions={mode:"inline",disabled:!1},a.count=0,a.fieldNames=[],a.rows=[],a.$watch("dataset",function(a){d(a)});var d=function(c){if(0==c.length&&a.editable)return a.fieldNames=["New_Field"],void(a.rows=[["New_Value"]]);if(c.length>0){var d=[];b.forEach(a.dataset,function(a){b.forEach(a,function(a,b){d.push(b)})}),d=b.uniq(d),a.fieldNames=d;var e=[];b.forEach(a.dataset,function(a){var c=[];b.forEach(d,function(b){c.push(a[b])}),e.push(c)}),a.rows=e}};d(a.dataset),a.removeField=function(c){a.fieldNames.splice(c,1),b.forEach(a.rows,function(a){a.splice(c,1)})},a.removeRow=function(b){a.rows.splice(b,1)},a.newField=function(){a.fieldNames.push("New_Field_"+a.count);var c=a.fieldNames.length;b.forEach(a.rows,function(b){b[c-1]="New_Value_"+a.count}),a.count++},a.newRow=function(){for(var b=[],c=0;c<a.fieldNames.length;c++)b[c]="New_Value_"+c+"."+a.count;a.rows.push(b)}}}}])});