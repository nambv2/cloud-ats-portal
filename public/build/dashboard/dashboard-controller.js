define(["dashboard/module","lodash","morris"],function(a,b){"use strict";a.registerController("DashboardCtrl",["$scope","$state","KeywordService","PerformanceService","ReportService","ScriptService",function(a,c,d,e,f,g){a.recent_finished_projects=[],a.performance_projects=[],a.recent_projects=[];var h=function(c){var d=[];b.forEach(c,function(a){var c=a.P+a.S+a.F,e=b.round(a.P/c*100,2),f=b.round(a.F/c*100,2),g={_id:a._id,name:a.x,percentPass:e,percentFail:f,totalCases:c};d.push(g)}),a.top_projects=d},i=function(c,d){var e=0,f=0,g=0,i=c.projectName,j=c.projectId,k=JSON.parse(c.suite_reports);b.forEach(k,function(a){e+=a.total_pass,f+=a.total_fail,g+=a.total_skip});var l={x:i,P:e,F:f,S:g,_id:j};if(a.recent_projects.push(l),a.recent_projects.length==d&&(a.recent_finished_projects=a.recent_projects,h(a.recent_finished_projects),a.recent_finished_projects.length>10)){var m=a.recent_finished_projects,n=m.length-10;a.recent_finished_projects.splice(10,n)}},j=function(a,b){return a.sort(function(a,c){var d=a[b],e=c[b];return e>d?-1:d>e?1:0})},k=function(){var c=[];d.list(function(a,e){c=a;var f=0;b.forEach(c,function(a,b){var c=a.lastJobId;void 0===c&&f++});var g=[];b.forEach(c,function(a,e){var h=a.lastJobId,k=c.length-f;if(h){var l=a._id,m=a.name;a.sort=e,d.getReport(l,h,function(c,d){if(a.lastJobId==c.functional_job_id&&(c.sort=a.sort,c.projectName=m,c.projectId=l,g.push(c)),k==g.length){var e=j(g,"sort");b.forEach(e,function(a){i(a,k)})}})}})}),e.projects(function(d){var e=0;c=[],c=d,b.forEach(c,function(a,b){var c=a.lastJobId;void 0===c&&e++}),b.forEach(c,function(c,d){var e=c.lastJobId;if(e){var h=c._id,i=c.name,j=c.lastScripts,k=0,l=0,m=0,n=0,o={},p=0;b.forEach(j,function(c){g.get(h,c._id,function(c,d){p++,k+=c.number_threads,l+=c.ram_up,m+=c.loops,n+=c.duration,p===j.length&&f.report(h,e,function(c,d){a.reports=c,b.forEach(a.reports,function(c){b.forEach(c,function(a){a.summary.error_percent=b.round(a.summary.error_percent,2)}),a.summaryReport=b.find(c,function(a){return"*SummaryReport*"==a.label}),o={_id:h,projectName:i,users:k,ram_up:l,loops:m,duration:n,samples:a.summaryReport.summary.samples,error_percent:a.summaryReport.summary.error_percent},0!=o.error_percent&&a.performance_projects.push(o)})})})})}})})};k(),a.redirectPerformance=function(a){c.go("app.performance",{id:a})},a.redirectKeyword=function(a){c.go("app.keyword",{id:a})}}])});